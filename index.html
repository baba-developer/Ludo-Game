<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3D Style Racing Game</title>
    <style>
        body { margin: 0; overflow: hidden; background: #111; font-family: 'Segoe UI', sans-serif; touch-action: manipulation; }
        #game-container { position: relative; width: 100vw; height: 100vh; background: #222; }
        canvas { width: 100%; height: 100%; display: block; }
        #top-ui { position: absolute; top: 0; left: 0; width: 100%; padding: 12px; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.7); box-sizing: border-box; z-index: 10; color: white; }
        #mobile-controls { position: absolute; bottom: 40px; width: 100%; display: flex; justify-content: space-between; padding: 0 30px; box-sizing: border-box; pointer-events: none; }
        .ctrl-btn { width: 80px; height: 80px; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 50%; color: white; font-size: 35px; display: flex; justify-content: center; align-items: center; pointer-events: auto; backdrop-filter: blur(5px); }
        .ctrl-btn:active { background: rgba(0, 210, 255, 0.4); }
        .ui-btn { padding: 6px 12px; font-size: 11px; cursor: pointer; border: none; border-radius: 5px; background: #e74c3c; color: white; font-weight: bold; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="top-ui">
            <div>SCORE: <span id="scoreVal">0</span> | BEST: <span id="highScore">0</span></div>
            <div>
                <button class="ui-btn" onclick="togglePause()">PAUSE</button>
                <button class="ui-btn" onclick="resetGame()">RESET</button>
            </div>
        </div>
        <canvas id="gameCanvas"></canvas>
        <div id="mobile-controls">
            <button class="ctrl-btn" id="leftBtn">◀</button>
            <button class="ctrl-btn" id="rightBtn">▶</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('scoreVal');
        const highscoreElement = document.getElementById('highScore');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        let score = 0;
        let highScore = localStorage.getItem('racingHighScore') || 0;
        highscoreElement.innerText = highScore;

        let gameActive = true, isPaused = false;
        let car = { x: 0, y: 0, w: 50, h: 90, speed: 8 };
        let enemies = [];
        let keys = { ArrowLeft: false, ArrowRight: false };

        const lBtn = document.getElementById('leftBtn');
        const rBtn = document.getElementById('rightBtn');
        lBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys.ArrowLeft = true; });
        lBtn.addEventListener('touchend', () => keys.ArrowLeft = false);
        rBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys.ArrowRight = true; });
        rBtn.addEventListener('touchend', () => keys.ArrowRight = false);

        // --- NEW 3D CAR DRAWING FUNCTION ---
        function draw3DCar(x, y, w, h, color, isPlayer) {
            let depth = 8; // Depth for 3D effect
            
            // 1. Shadow (Niche wali parchaai)
            ctx.fillStyle = "rgba(0,0,0,0.3)";
            ctx.fillRect(x + 10, y + 10, w, h);

            // 2. 3D Side/Bottom Layer (Darker color for depth)
            ctx.fillStyle = "rgba(0,0,0,0.4)";
            ctx.beginPath();
            ctx.roundRect(x + 3, y + 3, w, h, 10);
            ctx.fill();

            // 3. Main Car Body (Top layer)
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.roundRect(x, y, w, h, 10);
            ctx.fill();

            // 4. Car Details (Roof/Window)
            ctx.fillStyle = "rgba(255,255,255,0.2)";
            let windowY = isPlayer ? y + 15 : y + 55;
            ctx.fillRect(x + 8, windowY, w - 16, 20);

            // 5. Highlights (Symmetry/Gloss)
            ctx.strokeStyle = "rgba(255,255,255,0.3)";
            ctx.lineWidth = 2;
            ctx.strokeRect(x + 5, y + 5, w - 10, h - 10);
        }

        function spawn() {
            if (Math.random() < 0.02 && enemies.length < 4) {
                let laneWidth = canvas.width / 4;
                let lane = Math.floor(Math.random() * 4);
                let xPos = (lane * laneWidth) + (laneWidth/2) - 25;
                let speed = 5 + (score > 20 ? (score-20)*0.2 : 0);
                enemies.push({ x: xPos, y: -100, w: 50, h: 90, speed: speed });
            }
        }

        function update() {
            if (!gameActive || isPaused) return;
            car.y = canvas.height - 150;
            if (car.x === 0) car.x = canvas.width/2 - 25;

            if (keys.ArrowLeft && car.x > 10) car.x -= car.speed;
            if (keys.ArrowRight && car.x < canvas.width - 60) car.x += car.speed;

            enemies.forEach((enemy, i) => {
                enemy.y += enemy.speed;
                if (car.x < enemy.x + 50 && car.x + 50 > enemy.x && car.y < enemy.y + 90 && car.y + 90 > enemy.y) {
                    gameActive = false;
                    if(score > highScore) localStorage.setItem('racingHighScore', score);
                    alert("BOOM! Crash. Score: " + score);
                    resetGame();
                }
                if (enemy.y > canvas.height) { enemies.splice(i, 1); score++; scoreElement.innerText = score; }
            });
            spawn();
        }

        function togglePause() { isPaused = !isPaused; if(!isPaused) animate(); }
        function resetGame() { score = 0; scoreElement.innerText = 0; enemies = []; car.x = canvas.width/2 - 25; gameActive = true; isPaused = false; }

        function draw() {
            ctx.fillStyle = "#2c3e50"; ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Road Lines
            ctx.strokeStyle = "rgba(255,255,255,0.1)"; ctx.setLineDash([30, 30]);
            for(let i=1; i<4; i++) {
                ctx.beginPath(); ctx.moveTo(i * (canvas.width/4), 0); ctx.lineTo(i * (canvas.width/4), canvas.height); ctx.stroke();
            }

            // Draw 3D Styled Cars
            draw3DCar(car.x, car.y, car.w, car.h, "#00d2ff", true);
            enemies.forEach(e => draw3DCar(e.x, e.y, e.w, e.h, "#ff4757", false));
        }

        function animate() {
            if (isPaused || !gameActive) return;
            update(); draw(); requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>
