<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Frutix Blast - Auto Match Pro</title>
    <style>
        body { 
            margin: 0; background: #1a1a2e; height: 100vh; 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; touch-action: none;
        }

        /* Splash Screen */
        #splash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #4e31aa; color: white; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 10000;
        }

        /* Main Menu */
        #main-menu {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none; flex-direction: column;
            align-items: center; justify-content: center; z-index: 8000;
        }

        /* Level Grid */
        #level-menu {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #16213e; display: none; flex-direction: column;
            align-items: center; z-index: 9000; overflow-y: auto; padding: 40px 0;
        }

        .level-grid {
            display: grid; grid-template-columns: repeat(5, 60px); gap: 15px; padding: 20px;
        }

        .btn {
            width: 200px; padding: 15px; margin: 10px; border: none; border-radius: 50px;
            background: #e94560; color: white; font-size: 18px; font-weight: bold;
            box-shadow: 0 4px #950101; cursor: pointer; transition: 0.2s;
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }

        .level-btn {
            width: 60px; height: 60px; background: #e94560; color: white;
            border-radius: 15px; display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 18px; cursor: pointer; border: none;
        }
        .level-btn.locked { background: #444; opacity: 0.5; cursor: not-allowed; }

        /* Game UI */
        #game-ui { display: none; text-align: center; color: white; }
        .info-panel {
            background: #0f3460; padding: 15px; border-radius: 20px;
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;
            margin-bottom: 15px; border: 2px solid #e94560;
        }
        #grid { 
            display: grid; grid-template-columns: repeat(8, 42px); gap: 5px; 
            background: rgba(255,255,255,0.1); padding: 10px; border-radius: 15px;
        }
        .candy { 
            width: 42px; height: 42px; border-radius: 10px; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 26px; background: #fff; box-shadow: inset 0 -4px 0 rgba(0,0,0,0.1);
        }

        .loader { border: 5px solid rgba(255,255,255,0.2); border-top: 5px solid #fff; width: 40px; height: 40px; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="splash">
        <h1 style="font-size: 45px; margin-bottom: 10px;">Frutix Blast</h1>
        <div class="loader"></div>
        <p style="margin-top: 20px; font-weight: bold;">POWERED BY BABA-DEVELOPER</p>
    </div>

    <div id="main-menu">
        <h1 style="font-size: 50px; color: #e94560; text-shadow: 3px 3px #fff;">MENU</h1>
        <button class="btn" onclick="startLevel(unlockedLevel)">NEW GAME</button>
        <button class="btn" onclick="showLevelMenu()">LEVELS</button>
        <button class="btn" onclick="alert('Music & SFX Enabled')">SETTINGS</button>
    </div>

    <div id="level-menu">
        <h1 style="color: #fff;">LEVEL SELECTION</h1>
        <div class="level-grid" id="levelContainer"></div>
        <button class="btn" style="background:#555; width: 140px;" onclick="hideLevelMenu()">BACK</button>
    </div>

    <div id="game-ui">
        <div class="info-panel">
            <div>LVL: <b id="lvlShow">1</b></div>
            <div>GOAL: <b id="targetShow">200</b></div>
            <div>SCORE: <b id="scoreShow">0</b></div>
            <div style="color: #f9d342;">MOVES: <b id="movesShow">20</b></div>
        </div>
        <div id="grid"></div>
        <button class="btn" style="margin-top: 20px; width: 120px; background:#444;" onclick="backToMenu()">EXIT</button>
    </div>

    <script>
        const candyTypes = ['ðŸŽ', 'ðŸ‡', 'ðŸŠ', 'ðŸ«', 'ðŸ‹'];
        let unlockedLevel = parseInt(localStorage.getItem('fb_unlocked')) || 1;
        let currentLvl = 1, score = 0, moves = 20, target = 200, candies = [];

        window.onload = () => setTimeout(() => {
            document.getElementById('splash').style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
        }, 3000);

        function showLevelMenu() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('level-menu').style.display = 'flex';
            const container = document.getElementById('levelContainer');
            container.innerHTML = '';
            for(let i=1; i<=50; i++) {
                const b = document.createElement('button');
                b.innerText = i; b.className = 'level-btn' + (i > unlockedLevel ? ' locked' : '');
                b.onclick = i <= unlockedLevel ? () => startLevel(i) : () => alert("Level Locked!");
                container.appendChild(b);
            }
        }

        function hideLevelMenu() {
            document.getElementById('level-menu').style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
        }

        function startLevel(lvl) {
            currentLvl = lvl; 
            score = 0; // Score hamesha zero se shuru hoga
            target = 200 + (lvl*50); 
            moves = 25 - Math.floor(lvl/10);
            
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('level-menu').style.display = 'none';
            document.getElementById('game-ui').style.display = 'block';
            
            document.getElementById('lvlShow').innerText = lvl;
            document.getElementById('scoreShow').innerText = score;
            document.getElementById('targetShow').innerText = target;
            document.getElementById('movesShow').innerText = moves;
            initGrid();
        }

        function initGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = ''; candies = [];
            for(let i=0; i<64; i++) {
                const c = document.createElement('div');
                c.className = 'candy'; c.id = i;
                c.innerHTML = candyTypes[Math.floor(Math.random()*candyTypes.length)];
                grid.appendChild(c);
                candies.push(c);
            }
            addDrag();
        }

        function addDrag() {
            let idD, idR;
            candies.forEach(c => {
                c.onpointerdown = e => idD = parseInt(e.target.id);
                c.onpointerup = e => {
                    const t = document.elementFromPoint(e.clientX, e.clientY);
                    if(t && t.className === 'candy') {
                        idR = parseInt(t.id);
                        let adj = [idD-1, idD+1, idD-8, idD+8];
                        if(adj.includes(idR) && moves > 0) {
                            swap(idD, idR); moves--;
                            document.getElementById('movesShow').innerText = moves;
                        }
                    }
                }
            });
        }

        function swap(i1, i2) {
            let t = candies[i1].innerHTML;
            candies[i1].innerHTML = candies[i2].innerHTML;
            candies[i2].innerHTML = t;
        }

        // AUTO MATCH & SCORE ENGINE
        setInterval(() => {
            if(document.getElementById('game-ui').style.display === 'block') {
                // Check Horizontal Matches
                for(let i=0; i<64; i++) {
                    if(i % 8 < 6) {
                        let r = [i, i+1, i+2];
                        let val = candies[i].innerHTML;
                        if(val && r.every(idx => candies[idx].innerHTML === val)) {
                            score += 10;
                            document.getElementById('scoreShow').innerText = score;
                            r.forEach(idx => candies[idx].innerHTML = '');
                        }
                    }
                }
                // Check Vertical Matches
                for(let i=0; i<48; i++) {
                    let col = [i, i+8, i+16];
                    let val = candies[i].innerHTML;
                    if(val && col.every(idx => candies[idx].innerHTML === val)) {
                        score += 10;
                        document.getElementById('scoreShow').innerText = score;
                        col.forEach(idx => candies[idx].innerHTML = '');
                    }
                }
                
                // Gravity & Refill (Fixing Empty Boxes)
                for(let i=0; i<56; i++) {
                    // Agar niche wala box khali hai to upar wala niche aaye
                    if(candies[i+8].innerHTML === '' && candies[i].innerHTML !== '') {
                        candies[i+8].innerHTML = candies[i].innerHTML;
                        candies[i].innerHTML = '';
                    }
                }
                
                // Naye fruits add karna agar top row ya koi bhi box khali ho
                for(let i=0; i<64; i++) {
                    if(candies[i].innerHTML === '') {
                        candies[i].innerHTML = candyTypes[Math.floor(Math.random()*candyTypes.length)];
                    }
                }

                // Win/Loss Condition
                if(score >= target) {
                    alert("WELL DONE! Level Clear.");
                    if(currentLvl === unlockedLevel) {
                        unlockedLevel++; localStorage.setItem('fb_unlocked', unlockedLevel);
                    }
                    backToMenu();
                } else if(moves <= 0 && score < target) {
                    alert("OUT OF MOVES!"); backToMenu();
                }
            }
        }, 100);

        function backToMenu() {
            document.getElementById('game-ui').style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
        }
    </script>
</body>
</html>
