<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pro Racing Mobile</title>
    <style>
        body { margin: 0; overflow: hidden; background: #1a1a1a; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; height: 100vh; touch-action: manipulation; }
        
        #game-container { position: relative; width: 100vw; max-width: 400px; height: 70vh; background: #2c3e50; border-bottom: 5px solid #444; }
        canvas { width: 100%; height: 100%; display: block; }
        
        #top-ui { position: absolute; top: 0; left: 0; width: 100%; padding: 10px; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.7); box-sizing: border-box; z-index: 10; }
        .stats { color: white; font-size: 14px; font-weight: bold; }
        
        /* Mobile Controls */
        #mobile-controls { width: 100%; max-width: 400px; height: 30vh; display: flex; justify-content: space-around; align-items: center; background: #333; padding: 10px; box-sizing: border-box; }
        .ctrl-btn { width: 120px; height: 80px; background: #555; border: none; border-radius: 15px; color: white; font-size: 40px; font-weight: bold; -webkit-user-select: none; user-select: none; box-shadow: 0 6px #222; }
        .ctrl-btn:active { background: #777; box-shadow: 0 2px #222; transform: translateY(4px); }
        
        button.ui-btn { padding: 5px 10px; font-size: 10px; cursor: pointer; border: none; border-radius: 4px; background: #e74c3c; color: white; font-weight: bold; }
        #pauseBtn { background: #f1c40f; color: #000; }
        #shield-timer { position: absolute; top: 50px; width: 100%; text-align: center; color: #ff3f81; font-weight: bold; display: none; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="top-ui">
            <div class="stats">Score: <span id="scoreVal">0</span> | High: <span id="highScore">0</span></div>
            <div style="display:flex; gap:5px;">
                <button class="ui-btn" id="pauseBtn" onclick="togglePause()">PAUSE</button>
                <button class="ui-btn" onclick="resetGame()">RESET</button>
            </div>
        </div>
        <div id="shield-timer">SHIELD: <span id="timer">5</span>s</div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <div id="mobile-controls">
        <button class="ctrl-btn" id="leftBtn">◀</button>
        <button class="ctrl-btn" id="rightBtn">▶</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('scoreVal');
        const highscoreElement = document.getElementById('highScore');
        const shieldUI = document.getElementById('shield-timer');

        // Screen Size Adjustment
        function resize() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        let score = 0;
        let highScore = localStorage.getItem('racingHighScore') || 0;
        highscoreElement.innerText = highScore;

        let gameActive = true, isPaused = false, isShielded = false;
        let car = { x: 175, y: 0, w: 45, h: 80, speed: 7 };
        let enemies = [], hearts = [];
        const lanes = [canvas.width*0.1, canvas.width*0.35, canvas.width*0.6, canvas.width*0.8];

        // Controls Logic
        let keys = {};
        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        // Mobile Button Touch Logic
        const lBtn = document.getElementById('leftBtn');
        const rBtn = document.getElementById('rightBtn');
        lBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys['ArrowLeft'] = true; });
        lBtn.addEventListener('touchend', () => keys['ArrowLeft'] = false);
        rBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys['ArrowRight'] = true; });
        rBtn.addEventListener('touchend', () => keys['ArrowRight'] = false);

        function drawCar(x, y, color, isPlayer) {
            if (isPlayer && isShielded) {
                ctx.shadowBlur = 15; ctx.shadowColor = "#ff3f81";
            }
            ctx.fillStyle = "#000"; // Wheels
            ctx.fillRect(x-2, y+10, 5, 15); ctx.fillRect(x+42, y+10, 5, 15);
            ctx.fillRect(x-2, y+55, 5, 15); ctx.fillRect(x+42, y+55, 5, 15);
            ctx.fillStyle = color;
            ctx.beginPath(); ctx.roundRect(x, y, 45, 80, 8); ctx.fill();
            ctx.shadowBlur = 0;
        }

        function spawn() {
            let spawnChance = 0.02 + (score > 20 ? 0.01 : 0);
            if (Math.random() < spawnChance && enemies.length < 3) {
                let laneX = lanes[Math.floor(Math.random() * lanes.length)];
                let speed = 4 + (score > 20 ? (score-20)*0.2 : 0);
                enemies.push({ x: laneX, y: -100, w: 45, h: 80, speed: speed });
            }
            if (Math.random() < 0.003 && hearts.length < 1) {
                hearts.push({ x: lanes[Math.floor(Math.random()*lanes.length)]+10, y: -50 });
            }
        }

        function update() {
            if (!gameActive || isPaused) return;
            car.y = canvas.height - 120; // Keep car at bottom

            if (keys['ArrowLeft'] && car.x > 5) car.x -= car.speed;
            if (keys['ArrowRight'] && car.x < canvas.width - 50) car.x += car.speed;

            enemies.forEach((enemy, i) => {
                enemy.y += enemy.speed;
                if (car.x < enemy.x + 45 && car.x + 45 > enemy.x && car.y < enemy.y + 80 && car.y + 80 > enemy.y) {
                    if (!isShielded) {
                        gameActive = false;
                        if(score > highScore) localStorage.setItem('racingHighScore', score);
                        alert("Crash! Score: " + score);
                        resetGame();
                    }
                }
                if (enemy.y > canvas.height) { enemies.splice(i, 1); score++; scoreElement.innerText = score; }
            });

            hearts.forEach((h, i) => {
                h.y += 4;
                if (car.x < h.x + 30 && car.x + 45 > h.x && car.y < h.y + 30 && car.y + 80 > h.y) {
                    hearts.splice(i, 1); activateShield();
                }
            });
            spawn();
        }

        function activateShield() {
            isShielded = true; shieldUI.style.display = "block";
            let time = 5;
            let itv = setInterval(() => {
                time--; document.getElementById('timer').innerText = time;
                if(time <= 0) { clearInterval(itv); isShielded = false; shieldUI.style.display = "none"; }
            }, 1000);
        }

        function togglePause() { isPaused = !isPaused; document.getElementById('pauseBtn').innerText = isPaused ? "RESUME" : "PAUSE"; if(!isPaused) animate(); }

        function resetGame() {
            score = 0; scoreElement.innerText = 0; enemies = []; hearts = [];
            car.x = canvas.width/2 - 22; gameActive = true; isPaused = false;
        }

        function draw() {
            ctx.fillStyle = "#2c3e50"; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = "rgba(255,255,255,0.3)"; ctx.setLineDash([20, 20]);
            for(let i=1; i<4; i++) {
                ctx.beginPath(); ctx.moveTo(i * (canvas.width/4), 0); ctx.lineTo(i * (canvas.width/4), canvas.height); ctx.stroke();
            }
            drawCar(car.x, car.y, "#00d2ff", true);
            enemies.forEach(e => drawCar(e.x, e.y, "#e74c3c", false));
            ctx.font = "30px Arial"; hearts.forEach(h => ctx.fillText("❤️", h.x, h.y));
        }

        function animate() {
            if (isPaused || !gameActive) return;
            update(); draw(); requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>
