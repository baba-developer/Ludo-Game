<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Frutix Blast - Complete Edition</title>
    <style>
        body { 
            margin: 0; background: #2c3e50; height: 100vh; 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; font-family: 'Arial', sans-serif; overflow: hidden; touch-action: none;
        }

        /* 1. Splash Screen */
        #splash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #764ba2; color: white; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 10000;
        }

        /* 2. Main Menu */
        #main-menu {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: none; flex-direction: column;
            align-items: center; justify-content: center; z-index: 8000;
        }

        /* 3. Level Selection Menu */
        #level-menu {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #2c3e50; display: none; flex-direction: column;
            align-items: center; z-index: 9000; overflow-y: auto; padding: 30px 0;
        }

        .level-grid {
            display: grid; grid-template-columns: repeat(5, 60px); gap: 15px; padding: 20px;
        }

        /* Common Buttons */
        .btn {
            width: 220px; padding: 15px; margin: 10px; border: none; border-radius: 30px;
            background: #ff3f81; color: white; font-size: 18px; font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer;
        }
        .btn:active { transform: scale(0.95); }

        .level-btn {
            width: 60px; height: 60px; background: #ff3f81; color: white;
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 18px; cursor: pointer; border: none;
        }
        .level-btn.locked { background: #555; opacity: 0.6; cursor: not-allowed; }

        /* 4. Game UI */
        #game-ui { display: none; text-align: center; color: white; }
        .stats { display: flex; gap: 10px; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 15px; margin-bottom: 10px; font-size: 14px; }
        #grid { display: grid; grid-template-columns: repeat(8, 42px); gap: 4px; background: rgba(255,255,255,0.2); padding: 5px; border-radius: 10px; }
        .candy { width: 42px; height: 42px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px; background: white; }

        .loader { border: 4px solid #fff; border-top: 4px solid transparent; width: 30px; height: 30px; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="splash">
        <h1 style="font-size: 40px;">Frutix Blast</h1>
        <div class="loader"></div>
        <p style="margin-top: 20px;">POWERED BY BABA-DEVELOPER</p>
    </div>

    <div id="main-menu">
        <h1 style="color: white; font-size: 45px; margin-bottom: 40px; text-shadow: 2px 2px #ff3f81;">Frutix Blast</h1>
        <button class="btn" onclick="startNewGame()">NEW GAME</button>
        <button class="btn" onclick="showLevelMenu()">LEVELS</button>
        <button class="btn" onclick="alert('Settings: Sound & Music On')">SETTINGS</button>
    </div>

    <div id="level-menu">
        <h1 style="color: white;">SELECT LEVEL</h1>
        <div class="level-grid" id="levelButtons"></div>
        <button class="btn" style="background:#555; width: 150px;" onclick="hideLevelMenu()">BACK</button>
    </div>

    <div id="game-ui">
        <div class="stats">
            <div>LVL: <span id="currentLvl">1</span></div>
            <div>TARGET: <span id="target">200</span></div>
            <div>SCORE: <span id="score">0</span></div>
            <div style="color: #ffeb3b;">MOVES: <span id="moves">20</span></div>
        </div>
        <div id="grid"></div>
        <button class="btn" style="margin-top:20px; width:120px;" onclick="backToMainMenu()">EXIT</button>
    </div>

    <script>
        const splash = document.getElementById('splash');
        const mainMenu = document.getElementById('main-menu');
        const levelMenu = document.getElementById('level-menu');
        const gameUI = document.getElementById('game-ui');
        const levelButtonsContainer = document.getElementById('levelButtons');
        
        let currentLevel = 1;
        let score = 0;
        let moves = 20;
        let target = 200;
        const width = 8;
        const candies = [];
        const candyTypes = ['ðŸŽ', 'ðŸ‡', 'ðŸŠ', 'ðŸ«', 'ðŸ‹'];

        // Unlock Logic
        let unlockedLevel = parseInt(localStorage.getItem('frutixUnlocked')) || 1;

        // 1. Splash to Main Menu
        window.onload = () => {
            setTimeout(() => {
                splash.style.display = 'none';
                mainMenu.style.display = 'flex';
            }, 3000);
        };

        // Menu Navigation
        function startNewGame() {
            startLevel(unlockedLevel);
        }

        function showLevelMenu() {
            mainMenu.style.display = 'none';
            levelMenu.style.display = 'flex';
            drawLevelMenu();
        }

        function hideLevelMenu() {
            levelMenu.style.display = 'none';
            mainMenu.style.display = 'flex';
        }

        function backToMainMenu() {
            gameUI.style.display = 'none';
            mainMenu.style.display = 'flex';
        }

        function drawLevelMenu() {
            levelButtonsContainer.innerHTML = '';
            for (let i = 1; i <= 50; i++) {
                const btn = document.createElement('button');
                btn.innerText = i;
                btn.classList.add('level-btn');
                if (i > unlockedLevel) {
                    btn.classList.add('locked');
                    btn.onclick = () => alert("Pehle pichla level clear karein!");
                } else {
                    btn.onclick = () => startLevel(i);
                }
                levelButtonsContainer.appendChild(btn);
            }
        }

        function startLevel(lvl) {
            currentLevel = lvl;
            levelMenu.style.display = 'none';
            mainMenu.style.display = 'none';
            gameUI.style.display = 'block';
            
            score = 0;
            target = 200 + (lvl * 50);
            moves = 25 - Math.floor(lvl / 10);
            
            document.getElementById('currentLvl').innerText = lvl;
            document.getElementById('score').innerText = score;
            document.getElementById('target').innerText = target;
            document.getElementById('moves').innerText = moves;
            
            createBoard();
        }

        function createBoard() {
            const gridEl = document.getElementById('grid');
            gridEl.innerHTML = '';
            candies.length = 0;
            for (let i = 0; i < width * width; i++) {
                const candy = document.createElement('div');
                candy.classList.add('candy');
                candy.setAttribute('id', i);
                candy.innerHTML = candyTypes[Math.floor(Math.random() * candyTypes.length)];
                gridEl.appendChild(candy);
                candies.push(candy);
            }
            setupDrag();
        }

        function setupDrag() {
            let idD, idR;
            candies.forEach(c => {
                c.onpointerdown = (e) => idD = parseInt(e.target.id);
                c.onpointerup = (e) => {
                    const t = document.elementFromPoint(e.clientX, e.clientY);
                    if (t && t.classList.contains('candy')) {
                        idR = parseInt(t.id);
                        let adj = [idD-1, idD+1, idD-width, idD+width];
                        if (adj.includes(idR) && moves > 0) {
                            swap(idD, idR);
                            moves--;
                            document.getElementById('moves').innerText = moves;
                            setTimeout(checkMatches, 300);
                        }
                    }
                };
            });
        }

        function swap(i1, i2) {
            let t = candies[i1].innerHTML;
            candies[i1].innerHTML = candies[i2].innerHTML;
            candies[i2].innerHTML = t;
        }

        function checkMatches() {
            let hasMatch = false;
            // Horizontal check
            for (let i = 0; i < 62; i++) {
                if (i % 8 < 6) {
                    if (candies[i].innerHTML !== '' && candies[i].innerHTML === candies[i+1].innerHTML && candies[i].innerHTML === candies[i+2].innerHTML) {
                        score += 10; hasMatch = true;
                        candies[i].innerHTML = ''; candies[i+1].innerHTML = ''; candies[i+2].innerHTML = '';
                    }
                }
            }
            document.getElementById('score').innerText = score;
            if (score >= target) {
                alert("Level " + currentLevel + " Complete! ðŸŽ‰");
                if (currentLevel === unlockedLevel && unlockedLevel < 50) {
                    unlockedLevel++;
                    localStorage.setItem('frutixUnlocked', unlockedLevel);
                }
                backToMainMenu();
            } else if (moves <= 0) {
                alert("Game Over! Moves khatam ho gaye.");
                backToMainMenu();
            }
        }

        // Gravity and Refill
        setInterval(() => {
            if (gameUI.style.display === 'block') {
                for (let i = 0; i < 56; i++) {
                    if (candies[i + width].innerHTML === '') {
                        candies[i + width].innerHTML = candies[i].innerHTML;
                        candies[i].innerHTML = '';
                    }
                }
                for (let i = 0; i < 8; i++) {
                    if (candies[i].innerHTML === '') candies[i].innerHTML = candyTypes[Math.floor(Math.random() * candyTypes.length)];
                }
            }
        }, 200);

    </script>
</body>
</html>
