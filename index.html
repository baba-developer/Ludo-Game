 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Frutix Blast - Pro</title>
    <style>
        body { 
            margin: 0; background: #1a1a2e; height: 100vh; 
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; font-family: 'Segoe UI', sans-serif; 
            overflow: hidden; touch-action: none;
        }

        /* Splash */
        #splash {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #4e31aa; color: white; display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 10000;
        }
        .loader {
            border: 6px solid rgba(255,255,255,0.2); border-top: 6px solid #fff;
            border-radius: 50%; width: 50px; height: 50px;
            animation: spin 1s linear infinite; margin-top: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Menus */
        #main-menu, #level-menu {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); display: none; flex-direction: column;
            align-items: center; justify-content: center; z-index: 8000;
        }

        #settings-modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; max-width: 300px; background: #0f3460; border: 3px solid #e94560;
            border-radius: 20px; padding: 20px; color: white; display: none;
            flex-direction: column; align-items: center; z-index: 9500;
        }

        .btn {
            width: 180px; padding: 12px; margin: 8px; border: none; border-radius: 50px;
            background: #e94560; color: white; font-size: 16px; font-weight: bold;
            box-shadow: 0 4px #950101; cursor: pointer;
        }

        /* Game UI */
        #game-ui { display: none; text-align: center; color: white; width: 100%; max-width: 360px; }
        .top-bar { display: flex; justify-content: space-between; padding: 10px; width: 90%; }
        .mini-btn { background: #4e31aa; border: none; color: white; padding: 5px 10px; border-radius: 5px; }

        .info-panel {
            background: #0f3460; padding: 10px; border-radius: 15px;
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 5px; margin: 10px;
        }
        #grid { 
            display: grid; grid-template-columns: repeat(8, 40px); gap: 4px; 
            background: rgba(255,255,255,0.1); padding: 10px; border-radius: 15px;
            margin: auto;
        }
        .candy { 
            width: 40px; height: 40px; border-radius: 8px; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 24px; background: #fff; touch-action: none;
        }

        .level-grid { display: grid; grid-template-columns: repeat(5, 55px); gap: 10px; padding: 20px; }
        .level-btn { width: 55px; height: 55px; background: #e94560; color: white; border-radius: 12px; font-weight: bold; border: none; }
        .level-btn.locked { background: #444; opacity: 0.5; }
    </style>
</head>
<body>

    <div id="splash">
        <h1>Frutix Blast</h1>
        <div class="loader"></div>
        <p>PREPARING FRUITS...</p>
    </div>

    <div id="main-menu">
        <h1 style="color: #e94560; font-size: 40px;">MENU</h1>
        <button class="btn" onclick="startLevel(unlockedLevel)">PLAY NOW</button>
        <button class="btn" onclick="showLevelMenu()">LEVELS</button>
        <button class="btn" onclick="toggleSettings(true)" style="background:#4e31aa">SETTINGS</button>
    </div>

    <div id="settings-modal">
        <h2 id="modal-title">SETTINGS</h2>
        <button class="btn" onclick="resetProgress()">RESET DATA</button>
        <button class="btn" onclick="toggleSettings(false)">CLOSE</button>
    </div>

    <div id="level-menu">
        <h1>SELECT LEVEL</h1>
        <div class="level-grid" id="levelContainer"></div>
        <button class="btn" onclick="hideLevelMenu()">BACK</button>
    </div>

    <div id="game-ui">
        <div class="top-bar">
            <button class="mini-btn" onclick="pauseGame()">PAUSE</button>
            <button class="mini-btn" onclick="restartLevel()">RESTART</button>
        </div>
        <div class="info-panel">
            <div>LVL: <b id="lvlShow">1</b></div>
            <div>GOAL: <b id="targetShow">200</b></div>
            <div>SCORE: <b id="scoreShow">0</b></div>
            <div style="color: #f9d342;">MOVES: <b id="movesShow">25</b></div>
        </div>
        <div id="grid"></div>
        <button class="btn" style="margin-top:20px; background:#444;" onclick="backToMenu()">EXIT</button>
    </div>

    <script>
        const candyTypes = ['ðŸŽ', 'ðŸ‡', 'ðŸŠ', 'ðŸ«', 'ðŸ‹'];
        let unlockedLevel = parseInt(localStorage.getItem('fb_unlocked')) || 1;
        let currentLvl = 1, score = 0, moves = 25, target = 200, candies = [];
        let isGameActive = false, isPaused = false;

        // Sound Engine
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(freq, type) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.1);
            osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        }

        window.onload = () => setTimeout(() => {
            document.getElementById('splash').style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
        }, 2000);

        function toggleSettings(s) { document.getElementById('settings-modal').style.display = s?'flex':'none'; }
        
        function pauseGame() {
            isGameActive = false;
            document.getElementById('modal-title').innerText = "PAUSED";
            toggleSettings(true);
        }

        function restartLevel() {
            toggleSettings(false);
            startLevel(currentLvl);
        }

        function resetProgress() {
            if(confirm("Reset all progress?")) { localStorage.setItem('fb_unlocked', 1); location.reload(); }
        }

        function showLevelMenu() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('level-menu').style.display = 'flex';
            const container = document.getElementById('levelContainer'); container.innerHTML = '';
            for(let i=1; i<=50; i++) {
                const b = document.createElement('button');
                b.innerText = i; b.className = 'level-btn' + (i > unlockedLevel ? ' locked' : '');
                b.onclick = i <= unlockedLevel ? () => startLevel(i) : null;
                container.appendChild(b);
            }
        }

        function hideLevelMenu() {
            document.getElementById('level-menu').style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
        }

        function startLevel(lvl) {
            currentLvl = lvl; score = 0; target = 200 + (lvl*50); moves = 25;
            isGameActive = true; isPaused = false;
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('level-menu').style.display = 'none';
            document.getElementById('game-ui').style.display = 'block';
            document.getElementById('scoreShow').innerText = "0";
            document.getElementById('lvlShow').innerText = lvl;
            document.getElementById('targetShow').innerText = target;
            document.getElementById('movesShow').innerText = moves;
            initGrid();
        }

        function initGrid() {
            const grid = document.getElementById('grid'); grid.innerHTML = ''; candies = [];
            for(let i=0; i<64; i++) {
                const c = document.createElement('div');
                c.className = 'candy'; c.id = i;
                let fruit;
                do { fruit = candyTypes[Math.floor(Math.random()*candyTypes.length)]; } 
                while (wouldCreateMatch(i, fruit));
                c.innerHTML = fruit;
                grid.appendChild(c); candies.push(c);
            }
            addTouchLogic();
        }

        function wouldCreateMatch(i, fruit) {
            if (i % 8 >= 2 && candies[i-1].innerHTML === fruit && candies[i-2].innerHTML === fruit) return true;
            if (i >= 16 && candies[i-8].innerHTML === fruit && candies[i-16].innerHTML === fruit) return true;
            return false;
        }

        function checkMatches() {
            let hasMatch = false;
            for(let i=0; i<64; i++) {
                if(i % 8 < 6 && candies[i].innerHTML !== '' && candies[i].innerHTML === candies[i+1].innerHTML && candies[i].innerHTML === candies[i+2].innerHTML) hasMatch = true;
                if(i < 48 && candies[i].innerHTML !== '' && candies[i].innerHTML === candies[i+8].innerHTML && candies[i].innerHTML === candies[i+16].innerHTML) hasMatch = true;
            }
            return hasMatch;
        }

        function addTouchLogic() {
            let startID;
            candies.forEach(c => {
                c.onpointerdown = (e) => startID = parseInt(e.target.id);
                c.onpointerup = (e) => {
                    if (!isGameActive) return;
                    let touch = e.type.includes('touch') ? e.changedTouches[0] : e;
                    let targetEl = document.elementFromPoint(e.clientX, e.clientY);
                    if (targetEl && targetEl.className === 'candy') {
                        let endID = parseInt(targetEl.id);
                        handleMove(startID, endID);
                    }
                };
            });
        }

        function handleMove(id1, id2) {
            let adj = [id1-1, id1+1, id1-8, id1+8];
            if (id1 % 8 === 0 && id2 === id1 - 1) return;
            if (id1 % 8 === 7 && id2 === id1 + 1) return;

            if (adj.includes(id2) && moves > 0) {
                // Swap temporarily
                let val1 = candies[id1].innerHTML;
                let val2 = candies[id2].innerHTML;
                candies[id1].innerHTML = val2;
                candies[id2].innerHTML = val1;

                if (checkMatches()) {
                    // Match found! Confirm move
                    moves--;
                    document.getElementById('movesShow').innerText = moves;
                    playSound(400, 'square');
                } else {
                    // No match! Undo swap
                    setTimeout(() => {
                        candies[id1].innerHTML = val1;
                        candies[id2].innerHTML = val2;
                        playSound(150, 'sine'); // Wrong move sound
                    }, 200);
                }
            }
        }

        setInterval(() => {
            if(!isGameActive) return;
            let matched = false;
            for(let i=0; i<64; i++) {
                if(i % 8 < 6 && candies[i].innerHTML !== '' && candies[i].innerHTML === candies[i+1].innerHTML && candies[i].innerHTML === candies[i+2].innerHTML) {
                    score += 10; candies[i].innerHTML = ''; candies[i+1].innerHTML = ''; candies[i+2].innerHTML = ''; matched = true;
                }
                if(i < 48 && candies[i].innerHTML !== '' && candies[i].innerHTML === candies[i+8].innerHTML && candies[i].innerHTML === candies[i+16].innerHTML) {
                    score += 10; candies[i].innerHTML = ''; candies[i+8].innerHTML = ''; candies[i+16].innerHTML = ''; matched = true;
                }
            }
            if(matched) {
                document.getElementById('scoreShow').innerText = score;
                playSound(600, 'triangle');
            }

            // Gravity
            for(let i=0; i<56; i++) {
                if(candies[i+8].innerHTML === '' && candies[i].innerHTML !== '') {
                    candies[i+8].innerHTML = candies[i].innerHTML; candies[i].innerHTML = '';
                }
            }
            // Refill
            for(let i=0; i<64; i++) {
                if(candies[i].innerHTML === '') candies[i].innerHTML = candyTypes[Math.floor(Math.random()*candyTypes.length)];
            }

            if(score >= target) { alert("WINNER!"); backToMenu(); }
            else if(moves <= 0) { alert("OUT OF MOVES!"); backToMenu(); }
        }, 200);

        function backToMenu() {
            isGameActive = false;
            document.getElementById('game-ui').style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
        }
    </script>
</body>
</html>
